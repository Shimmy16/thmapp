name: Fullstack CI mit Docker Compose

on:
  push:
    branches:
      - main
      - master  # â† Optional: Falls du "master" statt "main" verwendest

jobs:
  fullstack-build:
    name: ğŸ³ Fullstack Docker Compose Build
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ” Checkout Code
        uses: actions/checkout@v3

      - name: ğŸ³ Set up Docker
        uses: docker/setup-buildx-action@v3

      - name: ğŸ“¦ Build & Start Containers (Mongo, Backend, Frontend)
        run: |
          docker compose up --build -d

      - name: â³ Wait for Services
        run: |
          echo "â±ï¸ Warten bis Backend erreichbar ist..."
          sleep 15
          curl --fail http://localhost:5000/api/assets || (echo "âŒ Backend nicht erreichbar" && exit 1)

      - name: âœ… Services laufen, Container stoppen
        run: docker compose down
